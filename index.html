<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>沉浸式体验 - 邦典藏族文化</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; font-family: 'Inter', system-ui, -apple-system, sans-serif; }
    
    /* 自定义字体平滑 */
    body {
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    /* 卡片悬浮效果增强 */
    .card-hover { 
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
      border: 1px solid rgba(255,255,255,0.1);
    }
    .card-hover:hover { 
      transform: translateY(-8px) scale(1.01); 
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); 
    }
    
    /* 模态框样式优化 */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
      z-index: 100;
      justify-content: center;
      align-items: center;
      padding: 16px;
      animation: overlayFadeIn 0.3s ease-out;
    }
    
    @keyframes overlayFadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .modal-content {
      background-color: white;
      border-radius: 24px;
      width: 100%;
      max-width: 500px;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      animation: modalFadeIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position: relative;
    }
    
    @keyframes modalFadeIn {
      from { opacity: 0; transform: translateY(-30px) scale(0.95); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }
    
    /* 颜色卡片优化 */
    .color-card {
      border-radius: 20px;
      border: 2px solid #f1f5f9;
      padding: 24px;
      margin-bottom: 20px;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      cursor: pointer;
      position: relative;
      overflow: hidden;
      background: linear-gradient(145deg, #ffffff, #f8fafc);
    }
    
    .color-card:hover {
      border-color: #cbd5e1;
      transform: translateX(2px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.05);
    }
    
    .color-card.selected {
      border-color: #4f46e5;
      background: linear-gradient(145deg, #f8fafc, #f0f4ff);
      transform: translateX(6px);
    }
    
    .color-card.selected::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 8px;
      height: 100%;
      background: linear-gradient(180deg, #4f46e5, #7c3aed);
      border-radius: 20px 0 0 20px;
    }
    
    /* 颜色预览优化 */
    .color-preview {
      width: 100%;
      height: 70px;
      border-radius: 16px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
    }
    
    .color-preview:hover {
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
      transform: scale(1.02);
    }
    
    .color-preview.white {
      border: 2px solid #e2e8f0;
    }
    
    /* 选中标记优化 */
    .checkmark {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 28px;
      height: 28px;
      background: linear-gradient(145deg, #4f46e5, #6366f1);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      opacity: 0;
      transform: scale(0.8) rotate(-15deg);
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
    }
    
    .color-card.selected .checkmark {
      opacity: 1;
      transform: scale(1) rotate(0);
    }
    
    /* 宣言结果样式优化 */
    .declaration-result, .payment-view, .payment-success-view, .image-viewer-modal {
      display: none;
    }
    
    .declaration-header {
      padding: 24px;
      text-align: center;
      border-bottom: 1px solid #f1f5f9;
      background: linear-gradient(180deg, #ffffff, #f8fafc);
    }
    
    .selected-colors-preview {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin: 24px 0;
      flex-wrap: wrap;
    }
    
    .color-circle {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      border: 3px solid #f1f5f9;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #1f2937;
      box-shadow: 0 6px 16px rgba(0,0,0,0.08);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .color-circle::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, rgba(255,255,255,0.1), transparent);
    }
    
    .color-circle:hover {
      transform: scale(1.08);
      box-shadow: 0 8px 20px rgba(0,0,0,0.12);
    }
    
    .color-circle.white {
      border: 3px solid #e2e8f0;
      color: #1f2937;
    }
    
    .declaration-content {
      padding: 24px;
    }
    
    .declaration-title {
      font-size: 20px;
      font-weight: 700;
      color: #4f46e5;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .declaration-text {
      background: linear-gradient(145deg, #f8fafc, #f0f4ff);
      padding: 24px;
      border-radius: 16px;
      border-left: 6px solid #4f46e5;
      margin-bottom: 24px;
      font-size: 16px;
      line-height: 1.8;
      color: #374151;
      box-shadow: 0 4px 12px rgba(0,0,0,0.04);
    }
    
    .fusion-text {
      background: linear-gradient(145deg, #f0f9ff, #e0f2fe);
      padding: 20px;
      border-radius: 16px;
      border-left: 6px solid #0ea5e9;
      font-size: 15px;
      line-height: 1.7;
      color: #0369a1;
      margin-bottom: 24px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.04);
    }
    
    /* 支付选项卡片优化 */
    .payment-card {
      border: 2px solid #f1f5f9;
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 20px;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      cursor: pointer;
      background: linear-gradient(145deg, #ffffff, #f8fafc);
    }
    
    .payment-card:hover {
      border-color: #94a3b8;
      transform: translateY(-6px);
      box-shadow: 0 12px 20px rgba(79, 70, 229, 0.08);
    }
    
    .payment-card.selected {
      border-color: #4f46e5;
      background: linear-gradient(145deg, #f5f3ff, #ede9fe);
      box-shadow: 0 8px 24px rgba(79, 70, 229, 0.1);
    }
    
    .price-tag {
      background: linear-gradient(145deg, #4f46e5, #6366f1);
      color: white;
      padding: 8px 16px;
      border-radius: 24px;
      font-weight: 700;
      font-size: 15px;
      box-shadow: 0 4px 12px rgba(79, 70, 229, 0.2);
    }
    
    /* 支付二维码样式优化 */
    .qr-container {
      width: 220px;
      height: 220px;
      margin: 24px auto;
      padding: 16px;
      background: linear-gradient(145deg, #ffffff, #f8fafc);
      border-radius: 20px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    
    .qr-container:hover {
      transform: scale(1.05);
      box-shadow: 0 12px 30px rgba(0,0,0,0.15);
    }
    
    .qr-container img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    
    /* 支付成功样式优化 */
    .success-icon {
      width: 90px;
      height: 90px;
      background: linear-gradient(145deg, #10b981, #34d399);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 42px;
      margin: 24px auto;
      box-shadow: 0 8px 24px rgba(16, 185, 129, 0.3);
      animation: successPulse 2s infinite;
    }
    
    @keyframes successPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .bangdian-image {
      width: 100%;
      max-width: 320px;
      margin: 24px auto;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 12px 28px rgba(0,0,0,0.15);
      transition: all 0.4s ease;
    }
    
    .bangdian-image:hover {
      transform: translateY(-4px);
      box-shadow: 0 16px 32px rgba(0,0,0,0.2);
    }
    
    .bangdian-image img {
      width: 100%;
      height: auto;
      display: block;
      transition: all 0.4s ease;
    }
    
    .bangdian-image:hover img {
      transform: scale(1.03);
    }
    
    /* 工坊定制步骤优化 */
    .workshop-steps {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin: 24px 0;
    }
    
    .step {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      padding: 20px;
      background: linear-gradient(145deg, #f9fafb, #f3f4f6);
      border-radius: 16px;
      border-left: 6px solid #f59e0b;
      transition: all 0.3s ease;
    }
    
    .step:hover {
      transform: translateX(4px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.06);
    }
    
    .step-number {
      background: linear-gradient(145deg, #f59e0b, #fbbf24);
      color: white;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      flex-shrink: 0;
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.2);
    }
    
    .step-content h5 {
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 6px;
      font-size: 16px;
    }
    
    .step-content p {
      font-size: 15px;
      color: #4b5563;
      line-height: 1.6;
    }
    
    /* 图片查看器样式优化 */
    .image-viewer-content {
      background-color: white;
      border-radius: 24px;
      width: 100%;
      max-width: 650px;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      animation: modalFadeIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    .full-size-image {
      width: 100%;
      height: auto;
      max-height: 70vh;
      object-fit: contain;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }
    
    .full-size-image:hover {
      box-shadow: 0 12px 32px rgba(0,0,0,0.15);
    }
    
    /* 自定义滚动条优化 */
    .modal-content::-webkit-scrollbar {
      width: 8px;
    }
    
    .modal-content::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 10px;
      margin: 10px 0;
    }
    
    .modal-content::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 10px;
      transition: all 0.3s ease;
    }
    
    .modal-content::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }
    
    /* 按钮样式统一优化 */
    button, a[role="button"] {
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      font-weight: 600;
      outline: none;
      border: none;
    }
    
    button:hover:not(:disabled), a[role="button"]:hover {
      transform: translateY(-2px);
    }
    
    button:disabled {
      cursor: not-allowed;
      opacity: 0.6;
    }
    
    /* 导航栏优化 */
    header {
      background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,255,255,0.95));
      backdrop-filter: blur(8px);
      border-bottom: 1px solid #f1f5f9;
    }
    
    /* 主标题下划线动画 */
    .title-underline {
      position: relative;
      overflow: hidden;
    }
    
    .title-underline::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, #f59e0b, #d97706);
      transform: translateX(-100%);
      animation: slideIn 1s ease forwards 0.5s;
    }
    
    @keyframes slideIn {
      to { transform: translateX(0); }
    }
    
    /* 适配小屏幕 */
    @media (max-width: 480px) {
      .modal-content {
        border-radius: 20px;
        max-height: 90vh;
      }
      
      .color-card, .payment-card {
        padding: 20px;
      }
      
      .color-preview {
        height: 60px;
      }
      
      .color-circle {
        width: 60px;
        height: 60px;
        font-size: 14px;
      }
      
      .qr-container {
        width: 200px;
        height: 200px;
      }
      
      .success-icon {
        width: 70px;
        height: 70px;
        font-size: 32px;
      }
    }
    
    /* 渐变背景增强 */
    .bg-gradient-primary {
      background: linear-gradient(135deg, #6366f1, #4f46e5);
    }
    
    /* 加载动画优化 */
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .animate-pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 font-sans">
  <!-- 导航栏 - 当前页面高亮 【LOGO点击返回主页】 -->
  <header class="fixed w-full z-50 py-4 px-5 md:px-8 shadow-sm">
    <div class="container mx-auto flex justify-between items-center">
      <a href="index.html" class="flex items-center gap-2 text-slate-800">
        <i class="fa fa-paint-brush text-2xl text-indigo-800"></i>
        <span class="font-bold text-xl">邦典</span>
      </a>
      <nav class="flex gap-6 text-base">
        <a href="decode.html" class="text-slate-600 hover:text-indigo-800 transition-colors duration-300">文化解码</a>
        <a href="experience.html" class="text-indigo-800 font-medium border-b-2 border-indigo-800 pb-1">沉浸式体验</a>
        <a href="map.html" class="text-slate-600 hover:text-indigo-800 transition-colors duration-300">体验地图</a>
      </nav>
    </div>
  </header>

  <!-- 沉浸式体验完整内容 -->
  <section class="w-full min-h-screen pt-24 pb-16 px-5 md:px-8">
    <div class="container mx-auto">
      <div class="text-center mb-12">
        <h2 class="text-[clamp(1.8rem,5vw,2.8rem)] font-bold text-indigo-800 mb-4 title-underline">邦典 · 沉浸式体验设计</h2>
        <p class="text-slate-600 text-lg max-w-2xl mx-auto">从文化认知到亲手创造，赋予邦典属于你的生命故事</p>
        <div class="w-24 h-1.5 bg-gradient-to-r from-amber-500 to-amber-600 mx-auto mt-6 rounded-full"></div>
      </div>

      <div class="grid md:grid-cols-2 gap-10">
        <!-- 设计工坊卡片 -->
        <div class="bg-white rounded-2xl overflow-hidden shadow-xl card-hover">
          <div class="h-72 overflow-hidden">
            <img src="图片12.png" alt="邦典设计工坊" class="w-full h-full object-cover transition-transform duration-700 hover:scale-105">
          </div>
          <div class="p-8">
            <h3 class="text-2xl font-bold text-indigo-800 mb-5 flex items-center">
              <i class="fa fa-paint-brush mr-3 text-indigo-600"></i>
              我的邦典 · 专属设计工坊
            </h3>
            <p class="text-slate-600 mb-6 text-base leading-relaxed">
              基于文化解码的认知，亲手设计属于你的数字邦典。自由搭配传统色彩，创作专属纹样，撰写你的生命宣言，让邦典成为你的身份表达。
            </p>
            <ul class="space-y-3 mb-8 text-slate-700">
              <li class="flex items-center"><i class="fa fa-check-circle text-emerald-600 mr-3 text-lg"></i> 6大藏族经典色系自由搭配</li>
              <li class="flex items-center"><i class="fa fa-check-circle text-emerald-600 mr-3 text-lg"></i> 12种传统纹样随心组合</li>
              <li class="flex items-center"><i class="fa fa-check-circle text-emerald-600 mr-3 text-lg"></i> 撰写个人化设计宣言</li>
              <li class="flex items-center"><i class="fa fa-check-circle text-emerald-600 mr-3 text-lg"></i> 生成高清数字作品</li>
            </ul>
            <a href="#" id="designBtn" class="inline-block w-full text-center px-8 py-4 bg-gradient-primary text-white rounded-xl font-semibold hover:opacity-95 transition-all duration-300 shadow-lg hover:shadow-xl">
              开启设计之旅 <i class="fa fa-magic ml-2"></i>
            </a>
          </div>
        </div>

        <!-- 互动游戏卡片 -->
        <div class="bg-white rounded-2xl overflow-hidden shadow-xl card-hover">
          <div class="h-72 overflow-hidden">
            <img src="图片13.png" alt="人生纹样游戏" class="w-full h-full object-cover transition-transform duration-700 hover:scale-105">
          </div>
          <div class="p-8">
            <h3 class="text-2xl font-bold text-rose-800 mb-5 flex items-center">
              <i class="fa fa-gamepad mr-3 text-rose-600"></i>
              编织人生 · 互动叙事游戏
            </h3>
            <p class="text-slate-600 mb-6 text-base leading-relaxed">
              沉浸式体验藏族女孩的成长历程，从少女到成年，每一次人生选择都会改变邦典的纹样与色彩，感受邦典与生命的紧密联结。
            </p>
            <ul class="space-y-3 mb-8 text-slate-700">
              <li class="flex items-center"><i class="fa fa-check-circle text-emerald-600 mr-3 text-lg"></i> 5个关键人生成长阶段体验</li>
              <li class="flex items-center"><i class="fa fa-check-circle text-emerald-600 mr-3 text-lg"></i> 了解邦典完整制作工艺</li>
              <li class="flex items-center"><i class="fa fa-check-circle text-emerald-600 mr-3 text-lg"></i> 选择决定纹样的最终形态</li>
              <li class="flex items-center"><i class="fa fa-check-circle text-emerald-600 mr-3 text-lg"></i> 解锁邦典背后的文化故事</li>
            </ul>
            <a href="gam.html" class="inline-block w-full text-center px-8 py-4 bg-gradient-to-r from-rose-700 to-rose-800 text-white rounded-xl font-semibold hover:opacity-95 transition-all duration-300 shadow-lg hover:shadow-xl">
              开始互动体验 <i class="fa fa-gamepad ml-2"></i>
            </a>
          </div>
        </div>
      </div>
      
      <!-- 底部返回主页按钮 -->
      <div class="text-center mt-16">
        <a href="index.html" class="px-10 py-4 bg-gradient-primary text-white rounded-full font-semibold hover:opacity-95 transition-all duration-300 inline-flex items-center gap-2 shadow-lg hover:shadow-xl">
          <i class="fa fa-home text-lg"></i> 返回主页
        </a>
      </div>
    </div>
  </section>

  <!-- 颜色选择模态框 - 卡片式布局 -->
  <div id="colorModal" class="modal-overlay">
    <div class="modal-content">
      <!-- 颜色选择视图 -->
      <div id="colorSelectionView">
        <!-- 模态框头部 -->
        <div class="sticky top-0 bg-white z-10 p-6 border-b border-slate-200">
          <div class="flex justify-between items-center mb-3">
            <h3 class="text-xl font-bold text-indigo-800 flex items-center">
              <i class="fa fa-palette mr-3 text-indigo-600"></i> 选择您的邦典色彩
            </h3>
            <button id="closeModal" class="text-slate-500 hover:text-slate-800 text-xl transition-colors p-2 rounded-full hover:bg-slate-100">
              <i class="fa fa-times"></i>
            </button>
          </div>
          <p class="text-slate-600 text-sm">每种颜色都承载独特的藏族文化意义，请选择3种颜色进行搭配</p>
          <div class="mt-4 bg-indigo-50 p-4 rounded-xl">
            <div class="flex items-center text-sm text-indigo-800">
              <i class="fa fa-info-circle mr-2"></i>
              <span>已选择 <span id="selectedCount" class="font-bold">0</span> 种颜色（需要选择3种）</span>
            </div>
          </div>
        </div>
        
        <!-- 颜色卡片列表 -->
        <div class="p-6" id="colorCardsContainer">
          <!-- 颜色卡片将通过JavaScript动态生成 -->
        </div>
        
        <!-- 底部按钮 -->
        <div class="sticky bottom-0 bg-white border-t border-slate-200 p-6">
          <div class="flex flex-col sm:flex-row gap-4">
            <button id="cancelBtn" class="px-6 py-4 text-slate-700 font-medium hover:bg-slate-100 rounded-xl transition-colors flex-1 shadow-sm">
              取消
            </button>
            <button id="confirmBtn" class="px-6 py-4 bg-gradient-primary text-white font-semibold rounded-xl hover:opacity-95 transition-colors flex-1 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed shadow-md">
              <i class="fa fa-check mr-2"></i> 确认选择 (0/3)
            </button>
          </div>
        </div>
      </div>
      
      <!-- 宣言结果视图 -->
      <div id="declarationResultView" class="declaration-result">
        <div class="declaration-header">
          <h3 class="text-xl font-bold text-indigo-800 flex items-center justify-center">
            <i class="fa fa-quote-left mr-3 text-indigo-600"></i> 您的邦典色彩宣言
          </h3>
          <p class="text-slate-600 text-sm mt-2">基于您选择的色彩组合，以下是您的专属邦典宣言</p>
        </div>
        
        <div class="selected-colors-preview" id="selectedColorsPreview">
          <!-- 选择的颜色将动态显示在这里 -->
        </div>
        
        <div class="declaration-content">
          <div class="declaration-title">
            <i class="fa fa-paint-brush text-indigo-600"></i>
            <span>色彩融合</span>
          </div>
          <div class="fusion-text" id="fusionText">
            <!-- 色彩融合描述将动态显示在这里 -->
          </div>
          
          <div class="declaration-title">
            <i class="fa fa-flag text-indigo-600"></i>
            <span>邦典宣言</span>
          </div>
          <div class="declaration-text" id="declarationText">
            <!-- 宣言将动态显示在这里 -->
          </div>
          
          <!-- 生成邦典按钮 -->
          <div class="mt-10 text-center">
            <button id="generateBangdianBtn" class="px-10 py-5 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold rounded-full hover:opacity-95 transition-all duration-300 shadow-xl hover:shadow-2xl transform hover:-translate-y-1">
              <i class="fa fa-image mr-2"></i> 生成专属邦典图
            </button>
            <p class="text-slate-500 text-sm mt-4">生成您的专属邦典图案，可选择数字版或实体版设计图</p>
          </div>
        </div>
        
        <div class="sticky bottom-0 bg-white border-t border-slate-200 p-6">
          <div class="flex flex-col sm:flex-row gap-4">
            <button id="backToSelectionBtn" class="px-6 py-4 text-slate-700 font-medium hover:bg-slate-100 rounded-xl transition-colors flex-1 shadow-sm">
              <i class="fa fa-arrow-left mr-2"></i> 重新选择颜色
            </button>
          </div>
        </div>
      </div>
      
      <!-- 支付视图 -->
      <div id="paymentView" class="payment-view">
        <div class="sticky top-0 bg-white z-10 p-6 border-b border-slate-200">
          <div class="flex justify-between items-center mb-3">
            <h3 class="text-xl font-bold text-indigo-800 flex items-center">
              <i class="fa fa-credit-card mr-3 text-indigo-600"></i> 生成专属邦典
            </h3>
            <button id="closePaymentBtn" class="text-slate-500 hover:text-slate-800 text-xl transition-colors p-2 rounded-full hover:bg-slate-100">
              <i class="fa fa-times"></i>
            </button>
          </div>
          <p class="text-slate-600 text-sm">选择您想要的邦典类型并完成支付</p>
        </div>
        
        <div class="p-6">
          <!-- 支付选项 -->
          <div class="mb-10">
            <h4 class="text-lg font-semibold text-slate-800 mb-5">选择邦典类型</h4>
            
            <div class="payment-card" id="digitalCard" data-type="digital" data-price="0.1">
              <div class="flex justify-between items-start mb-4">
                <div>
                  <h5 class="font-bold text-lg text-slate-800">数字邦典高清图片</h5>
                  <p class="text-slate-600 text-sm mt-1">生成专属高清数字邦典图，可用于分享、打印</p>
                </div>
                <div class="price-tag">¥0.1</div>
              </div>
              <ul class="space-y-2 text-slate-700 text-sm">
                <li class="flex items-center"><i class="fa fa-check text-emerald-600 mr-2"></i> 高清分辨率 (3000×3000)</li>
                <li class="flex items-center"><i class="fa fa-check text-emerald-600 mr-2"></i> PNG格式，背景透明</li>
                <li class="flex items-center"><i class="fa fa-check text-emerald-600 mr-2"></i> 无水印永久使用</li>
                <li class="flex items-center"><i class="fa fa-check text-emerald-600 mr-2"></i> 支持社交媒体分享</li>
              </ul>
            </div>
            
            <div class="payment-card" id="physicalCard" data-type="physical" data-price="4.99">
              <div class="flex justify-between items-start mb-4">
                <div>
                  <h5 class="font-bold text-lg text-slate-800">实体邦典设计图 + 工坊制作</h5>
                  <p class="text-slate-600 text-sm mt-1">生成实体设计图并委托工坊制作实物邦典</p>
                </div>
                <div class="price-tag">¥4.99</div>
              </div>
              <ul class="space-y-2 text-slate-700 text-sm">
                <li class="flex items-center"><i class="fa fa-check text-emerald-600 mr-2"></i> 专业级实体设计图纸</li>
                <li class="flex items-center"><i class="fa fa-check text-emerald-600 mr-2"></i> 可委托藏族工坊制作</li>
                <li class="flex items-center"><i class="fa fa-check text-emerald-600 mr-2"></i> 传统手工技艺制作</li>
                <li class="flex items-center"><i class="fa fa-check text-emerald-600 mr-2"></i> 工坊按设计图制作，周期15-20天</li>
                <li class="flex items-center"><i class="fa fa-check text-emerald-600 mr-2"></i> 联系商家可邮寄到家</li>
              </ul>
            </div>
          </div>
          
          <!-- 工坊定制步骤说明 -->
          <div id="workshopCustomization" style="display: none;">
            <h4 class="text-lg font-semibold text-slate-800 mb-5">实体邦典定制流程</h4>
            <div class="workshop-steps">
              <div class="step">
                <div class="step-number">1</div>
                <div class="step-content">
                  <h5>前往合作工坊</h5>
                  <p>凭设计图前往《西藏非遗深度体验地图》中的合作工坊</p>
                </div>
              </div>
              <div class="step">
                <div class="step-number">2</div>
                <div class="step-content">
                  <h5>选择邦典材质</h5>
                  <p>根据个人偏好选择材质（基础棉质或高端羊毛）</p>
                </div>
              </div>
              <div class="step">
                <div class="step-number">3</div>
                <div class="step-content">
                  <h5>支付定制费用</h5>
                  <p>基础棉质：100-400元，高端羊毛：401-800元</p>
                </div>
              </div>
              <div class="step">
                <div class="step-number">4</div>
                <div class="step-content">
                  <h5>等待制作完成</h5>
                  <p>工坊按设计图制作，周期15-20天，联系商家可邮寄到家</p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 支付二维码 -->
          <div class="text-center mb-10" id="qrCodeSection">
            <h4 class="text-lg font-semibold text-slate-800 mb-5">扫码支付</h4>
            <p class="text-slate-600 mb-3">请使用微信或支付宝扫描下方二维码完成支付</p>
            <p class="text-slate-800 font-bold mb-5" id="paymentAmount">支付金额：¥0.00</p>
            
            <div class="qr-container">
              <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=weixin://wxpay/bizpayurl?pr=yourpaymentcode" alt="支付二维码" id="qrCodeImage">
            </div>
            
            <p class="text-slate-500 text-sm mt-5">支付成功后，将自动生成您的专属邦典</p>
          </div>
          
          <!-- 支付中状态 -->
          <div class="text-center mb-10" id="paymentProcessing" style="display: none;">
            <div class="animate-spin rounded-full h-20 w-20 border-t-4 border-b-4 border-indigo-600 mx-auto mb-5"></div>
            <h4 class="text-lg font-semibold text-slate-800 mb-3">支付处理中...</h4>
            <p class="text-slate-600">正在验证您的支付信息，请稍候</p>
          </div>
        </div>
        
        <div class="sticky bottom-0 bg-white border-t border-slate-200 p-6">
          <div class="flex flex-col sm:flex-row gap-4">
            <button id="backToDeclarationBtn" class="px-6 py-4 text-slate-700 font-medium hover:bg-slate-100 rounded-xl transition-colors flex-1 shadow-sm">
              <i class="fa fa-arrow-left mr-2"></i> 返回宣言
            </button>
            <button id="confirmPaymentBtn" class="px-6 py-4 bg-gradient-primary text-white font-semibold rounded-xl hover:opacity-95 transition-colors flex-1 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed shadow-md">
              <i class="fa fa-credit-card mr-2"></i> 确认支付
            </button>
          </div>
        </div>
      </div>
      
      <!-- 支付成功视图 -->
      <div id="paymentSuccessView" class="payment-success-view">
        <div class="sticky top-0 bg-white z-10 p-6 border-b border-slate-200">
          <div class="flex justify-between items-center mb-3">
            <h3 class="text-xl font-bold text-emerald-700 flex items-center">
              <i class="fa fa-check-circle mr-3 text-emerald-600"></i> 支付成功！
            </h3>
            <button id="closeSuccessBtn" class="text-slate-500 hover:text-slate-800 text-xl transition-colors p-2 rounded-full hover:bg-slate-100">
              <i class="fa fa-times"></i>
            </button>
          </div>
          <p class="text-slate-600 text-sm">您的专属邦典已生成</p>
        </div>
        
        <div class="p-6">
          <!-- 成功图标 -->
          <div class="success-icon">
            <i class="fa fa-check"></i>
          </div>
          
          <div class="text-center mb-10">
            <h4 class="text-2xl font-bold text-slate-800 mb-3">支付成功！</h4>
            <p class="text-slate-600 mb-2">订单号：<span id="orderNumber" class="font-mono">BD2023<span id="randomOrder">123456</span></span></p>
            <p class="text-slate-600 mb-5">支付时间：<span id="paymentTime">2023-11-15 14:30:25</span></p>
            
            <div class="bg-emerald-50 p-5 rounded-xl mb-8">
              <p class="text-emerald-700 font-medium" id="successMessage">您的数字邦典高清图片已生成！</p>
            </div>
          </div>
          
          <!-- 生成的邦典图片 -->
          <div class="bangdian-image" id="bangdianImageContainer">
            <!-- 邦典图片将动态显示在这里 -->
          </div>
          
          <!-- 查看高清图片按钮 -->
          <div class="mt-10 text-center">
            <button id="viewImageBtn" class="px-8 py-4 bg-gradient-primary text-white font-semibold rounded-xl hover:opacity-95 transition-colors duration-300 inline-flex items-center shadow-lg hover:shadow-xl">
              <i class="fa fa-eye mr-2"></i> 查看高清图片
            </button>
          </div>
          
          <!-- 实体邦典定制信息 -->
          <div class="mt-10 p-5 bg-amber-50 rounded-xl border border-amber-200" id="physicalOrderInfo" style="display: none;">
            <h5 class="font-bold text-amber-800 mb-4 flex items-center">
              <i class="fa fa-info-circle mr-2"></i> 实体邦典定制流程
            </h5>
            
            <div class="mb-5">
              <p class="text-amber-700 text-sm mb-4">您的实体邦典设计图已生成！凭借此设计图可前往合作工坊定制实体邦典。</p>
              
              <div class="bg-white p-4 rounded-xl mb-5 shadow-sm">
                <h6 class="font-semibold text-slate-800 mb-3">下一步操作：</h6>
                <ol class="text-slate-700 text-sm space-y-3 ml-5 list-decimal">
                  <li>前往《西藏非遗深度体验地图》中的合作工坊</li>
                  <li>出示设计图，选择材质（基础棉质或高端羊毛）</li>
                  <li>支付定制费用：基础棉质100-400元，高端羊毛401-800元</li>
                  <li>工坊按设计图制作，周期15-20天，联系商家可邮寄到家</li>
                </ol>
              </div>
              
              <div class="mt-5 bg-blue-50 p-4 rounded-xl border border-blue-200">
                <p class="text-blue-800 text-sm font-medium flex items-center">
                  <i class="fa fa-phone mr-2"></i>
                  工坊联系方式：23804798
                </p>
                <p class="text-blue-600 text-xs mt-2">想要邮寄到家，可以联系工坊安排邮寄服务</p>
              </div>
            </div>
          </div>
        </div>
        
        <div class="sticky bottom-0 bg-white border-t border-slate-200 p-6">
          <button id="backToHomeBtn" class="px-8 py-4 w-full text-slate-700 font-medium hover:bg-slate-100 rounded-xl transition-colors flex items-center justify-center shadow-sm">
            <i class="fa fa-home mr-2"></i> 返回体验主页
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 图片查看器模态框 -->
  <div id="imageViewerModal" class="modal-overlay image-viewer-modal">
    <div class="image-viewer-content">
      <div class="sticky top-0 bg-white z-10 p-6 border-b border-slate-200">
        <div class="flex justify-between items-center mb-3">
          <h3 class="text-xl font-bold text-indigo-800 flex items-center">
            <i class="fa fa-image mr-3 text-indigo-600"></i> 高清邦典图片
          </h3>
          <button id="closeImageViewer" class="text-slate-500 hover:text-slate-800 text-xl transition-colors p-2 rounded-full hover:bg-slate-100">
            <i class="fa fa-times"></i>
          </button>
        </div>
        <p class="text-slate-600 text-sm">您的专属邦典高清图片</p>
      </div>
      
      <div class="p-6">
        <div id="fullSizeImageContainer">
          <!-- 高清图片将动态显示在这里 -->
        </div>
        
        <div class="text-center mt-8">
          <button id="closeViewerBtn" class="px-8 py-4 text-slate-700 font-medium hover:bg-slate-100 rounded-xl transition-colors shadow-sm">
            关闭
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // 颜色数据 - 来自颜色宣言.docx
    const colorData = [
      {
        id: 1,
        name: "白色",
        simpleName: "白",
        colorCode: "#FFFFFF",
        symbol: "雪山、云朵",
        meaning: "象征纯洁无瑕、质朴本真",
        declaration: "以雪域之白为底色，坚守初心本真，于纷繁之中不染尘俗，让设计与生活回归纯粹的本貌。"
      },
      {
        id: 2,
        name: "黄色",
        simpleName: "黄",
        colorCode: "#F59E0B",
        symbol: "草原、金沙",
        meaning: "象征富足繁荣、生机盎然",
        declaration: "撷取高原金黄的生机，织就繁盛的愿景，让每一寸色彩都承载对生活的热忱，传递富足安康的祈愿。"
      },
      {
        id: 3,
        name: "红色",
        simpleName: "红",
        colorCode: "#DC2626",
        symbol: "火焰、暖阳",
        meaning: "象征热情奔放、赤诚热烈",
        declaration: "以炽烈的红色为魂，怀揣赤诚之心，将民族文化的温度注入经纬，让设计迸发直击人心的力量。"
      },
      {
        id: 4,
        name: "蓝色",
        simpleName: "蓝",
        colorCode: "#2563EB",
        symbol: "天空、湖泊",
        meaning: "象征深邃辽阔、宁静致远",
        declaration: "借天空湖泊的湛蓝，容纳天地的辽阔，于设计中沉淀思考，让作品承载深邃的文化底蕴与从容的气度。"
      },
      {
        id: 5,
        name: "绿色",
        simpleName: "绿",
        colorCode: "#16A34A",
        symbol: "森林、青稞田",
        meaning: "象征生机活力、生生不息",
        declaration: "萃取草木的青绿生机，传承民族文化的生长之力，让传统在现代设计中焕发蓬勃的新生。"
      },
      {
        id: 6,
        name: "黑色",
        simpleName: "黑",
        colorCode: "#1F2937",
        symbol: "大地、岩石",
        meaning: "象征沉稳坚韧、底蕴厚重",
        declaration: "以大地岩石的玄黑为基，承载千年文化的厚重，于沉稳中坚守传承，让每一道纹路都镌刻历史的印记。"
      }
    ];

    // 颜色搭配宣言数据 - 来自20种颜色宣言.docx
    // 为每种搭配添加对应的图片URL（20种不同的邦典图片）
    const colorCombinations = [
      {
        colors: ["白", "黄", "红"],
        fusion: "纯洁本真为底，富足生机为韵，热烈赤诚为魂，是高原天地间最鲜活的生命图景。",
        declaration: "以雪域白坚守初心，以高原黄承载繁盛，以炽烈红传递赤诚，让设计织就民族文化里最鲜活的生活祈愿。",
        imageUrl:"1.jig"
      },
      {
        colors: ["白", "黄", "蓝"],
        fusion: "雪山的纯净、草原的丰饶、天空的辽阔，勾勒出高原宁静而富足的底色。",
        declaration: "撷雪域之白守本真，取草原之黄纳繁盛，借苍穹之蓝容辽阔，让作品在纯粹中沉淀深邃，在从容中彰显生机。",
        imageUrl: "2.jpg"
      },
      {
        colors: ["白", "黄", "绿"],
        fusion: "云朵的洁白、金沙的璀璨、草木的青翠，是自然馈赠的生长与希望之景。",
        declaration: "以白为底存本真，以黄为脉载富足，以绿为姿焕生机，让传统纹样在现代设计里生长出蓬勃的新生力量。",
        imageUrl: "3.jpg"
      },
      {
        colors: ["白", "黄", "黑"],
        fusion: "雪山的圣洁、草原的丰盈、大地的厚重，是高原文化传承的根基与底色。",
        declaration: "携雪域白坚守初心，拥高原黄拥抱繁盛，立大地黑承载厚重，让每一寸织纹都镌刻民族千年的传承与风骨。",
        imageUrl: "4.jpg"
      },
      {
        colors: ["白", "红", "蓝"],
        fusion: "云朵的纯净、火焰的炽热、天空的深邃，碰撞出民族文化中热烈而从容的精神内核。",
        declaration: "以白守本真不染尘，以红燃赤诚传温度，以蓝纳辽阔蕴深邃，让设计在炽烈与宁静间，传递直击人心的文化力量。",
        imageUrl: "5.jpg"
      },
      {
        colors: ["白", "红", "绿"],
        fusion: "雪山的纯洁、火焰的热烈、青稞田的生机，是高原生命活力的极致绽放。",
        declaration: "取白之纯粹守初心，得红之炽热传温度，撷绿之鲜活焕新生，让民族文化的火种在蓬勃生机里永续传承。",
        imageUrl: "6.jpg"
      },
      {
        colors: ["白", "红", "黑"],
        fusion: "云朵的洁白、火焰的赤诚、大地的沉稳，是民族精神中坚守与热忱的交融。",
        declaration: "以白为底守本真之姿，以红为魂燃赤诚之心，以黑为基承厚重之韵，让设计在纯粹与热烈间，锚定文化传承的根脉。",
        imageUrl: "7.jpg"
      },
      {
        colors: ["白", "蓝", "绿"],
        fusion: "天空的湛蓝、云朵的洁白、草木的青绿，是高原自然里宁静生长的诗意画卷。",
        declaration: "借天空之蓝纳辽阔，拥雪域之白守本真，撷草木之绿焕生机，让作品在从容沉淀中，生长出传统与现代共生的活力。",
        imageUrl: "8.jpg"
      },
      {
        colors: ["白", "蓝", "黑"],
        fusion: "云朵的纯净、湖泊的深邃、大地的厚重，是高原文化中内敛而深邃的精神底色。",
        declaration: "以白存本真之态，以蓝蕴深邃之思，以黑承厚重之魂，让每一道纹路都承载民族文化的从容气度与千年底蕴。",
        imageUrl: "9.jpg"
      },
      {
        colors: ["白", "绿", "黑"],
        fusion: "雪山的圣洁、青稞田的生机、大地的沉稳，是高原生命传承中生长与坚守的力量。",
        declaration: "携白之纯粹守初心，拥绿之鲜活焕新生，立黑之厚重承传承，让传统在现代设计中，扎根大地，蓬勃生长。",
        imageUrl: "10.jpg"
      },
      {
        colors: ["黄", "红", "蓝"],
        fusion: "草原的丰饶、火焰的热烈、天空的辽阔，是高原生活里热忱与富足的交响。",
        declaration: "取草原之黄纳繁盛，燃火焰之红传赤诚，借苍穹之蓝容天地，让设计织就对生活的热忱祈愿与辽阔胸怀。",
        imageUrl: "11.jpg"
      },
      {
        colors: ["黄", "红", "绿"],
        fusion: "金沙的璀璨、火焰的炽热、草木的青翠，是高原大地生机盎然、富足热烈的缩影。",
        declaration: "以黄载富足安康之愿，以红燃赤诚热烈之心，以绿焕生生不息之力，让民族纹样在色彩碰撞中迸发蓬勃的生命力。",
        imageUrl: "12.jpg"
      },
      {
        colors: ["黄", "红", "黑"],
        fusion: "草原的丰盈、火焰的赤诚、大地的厚重，是民族文化传承中热忱与坚守的根基。",
        declaration: "拥高原黄揽繁盛之景，燃炽烈红怀赤诚之心，立大地黑承千年之韵，让设计在热烈与沉稳间，镌刻文化传承的印记。",
        imageUrl: "13.jpg"
      },
      {
        colors: ["黄", "蓝", "绿"],
        fusion: "草原的金黄、天空的湛蓝、草木的青绿，绘就高原自然和谐共生的生命画卷。",
        declaration: "以黄纳大地之丰饶，以蓝容天地之辽阔，以绿焕生命之活力，让设计在自然的色彩交响中，传递和谐共生的美好祈愿。",
        imageUrl: "14.jpg"
      },
      {
        colors: ["黄", "蓝", "黑"],
        fusion: "金沙的璀璨、湖泊的深邃、大地的沉稳，是高原文化中富足与内敛的完美融合。",
        declaration: "揽金黄之繁盛，拥湛蓝之深邃，立玄黑之厚重，让每一道织纹都承载高原文化的富足底蕴与沉稳气度。",
        imageUrl: "15.jpg"
      },
      {
        colors: ["黄", "绿", "黑"],
        fusion: "草原的丰盈、草木的生机、大地的厚重，是高原生命传承中生长与坚守的力量源泉。",
        declaration: "以黄载富足之愿，以绿焕生长之力，以黑立传承之基，让传统纹样在现代设计中扎根大地，向阳而生。",
        imageUrl: "16.jpg"
      },
      {
        colors: ["红", "蓝", "绿"],
        fusion: "火焰的炽热、天空的辽阔、草木的生机，碰撞出民族文化中热烈而鲜活的生命力量。",
        declaration: "燃红之赤诚传温度，纳蓝之辽阔容天地，撷绿之鲜活焕新生，让设计在色彩的碰撞中，迸发民族文化的蓬勃生命力。",
        imageUrl: "17.jpg"
      },
      {
        colors: ["红", "蓝", "黑"],
        fusion: "火焰的热烈、湖泊的深邃、大地的沉稳，是民族精神中热忱与内敛的深度交融。",
        declaration: "以红燃赤诚之心，以蓝蕴深邃之思，以黑承厚重之魂，让设计在热烈与沉稳间，传递民族文化的深刻内涵。",
        imageUrl: "18.jpg"
      },
      {
        colors: ["红", "绿", "黑"],
        fusion: "火焰的炽热、草木的生机、大地的沉稳，是高原生命热烈生长、扎根传承的精神写照。",
        declaration: "燃红之热烈传温度，撷绿之鲜活焕生机，立黑之厚重承传承，让民族文化的火种在大地的滋养下永续生长。",
        imageUrl: "19.jpg"
      },
      {
        colors: ["蓝", "绿", "黑"],
        fusion: "天空的辽阔、草木的生机、大地的厚重，绘就高原自然沉静生长、底蕴深厚的生命图景。",
        declaration: "纳蓝之辽阔容天地，撷绿之鲜活焕生机，立黑之厚重承传承，让设计在沉静中生长，在传承中焕发新生。",
        imageUrl: "20.jpg"
      }
    ];

    // 初始化变量
    let selectedColors = [];
    let selectedPaymentType = null;
    
    // DOM加载完成后执行
    document.addEventListener('DOMContentLoaded', function() {
      // 生成颜色卡片
      generateColorCards();
      
      // 绑定事件监听
      bindEventListeners();
      
      // 设置当前时间
      document.getElementById('paymentTime').textContent = new Date().toLocaleString('zh-CN', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      }).replace(/\//g, '-');
      
      // 生成随机订单号
      document.getElementById('randomOrder').textContent = Math.floor(100000 + Math.random() * 900000);
    });
    
    // 生成颜色卡片
    function generateColorCards() {
      const container = document.getElementById('colorCardsContainer');
      container.innerHTML = '';
      
      colorData.forEach(color => {
        const card = document.createElement('div');
        card.className = 'color-card';
        card.dataset.id = color.id;
        card.dataset.name = color.simpleName;
        
        // 构建颜色卡片HTML
        card.innerHTML = `
          <div class="color-preview ${color.simpleName === '白' ? 'white' : ''}" style="background-color: ${color.colorCode}">
            <span class="text-xl font-bold ${color.simpleName === '黑' || color.simpleName === '红' ? 'text-white' : 'text-slate-800'}">${color.name}</span>
            <div class="checkmark"><i class="fa fa-check"></i></div>
          </div>
          <h4 class="font-bold text-lg text-slate-800 mb-2">${color.name} · ${color.symbol}</h4>
          <p class="text-slate-600 text-sm mb-3">${color.meaning}</p>
          <p class="text-slate-700 text-sm italic">${color.declaration}</p>
        `;
        
        container.appendChild(card);
        
        // 绑定点击事件
        card.addEventListener('click', function() {
          toggleColorSelection(this);
        });
      });
    }
    
    // 切换颜色选择状态
    function toggleColorSelection(card) {
      const colorId = card.dataset.id;
      const colorName = card.dataset.name;
      
      // 如果已选中，取消选择
      if (card.classList.contains('selected')) {
        card.classList.remove('selected');
        selectedColors = selectedColors.filter(item => item.id !== colorId);
      } else {
        // 如果未选中且已选满3个，提示用户
        if (selectedColors.length >= 3) {
          alert('最多只能选择3种颜色，请先取消已选颜色');
          return;
        }
        
        // 添加选择
        card.classList.add('selected');
        selectedColors.push({
          id: colorId,
          name: colorName,
          fullName: colorData.find(c => c.id == colorId).name,
          colorCode: colorData.find(c => c.id == colorId).colorCode
        });
      }
      
      // 更新选择计数
      updateSelectedCount();
    }
    
    // 更新选择计数
    function updateSelectedCount() {
      const countElement = document.getElementById('selectedCount');
      const confirmBtn = document.getElementById('confirmBtn');
      
      countElement.textContent = selectedColors.length;
      confirmBtn.innerHTML = `<i class="fa fa-check mr-2"></i> 确认选择 (${selectedColors.length}/3)`;
      
      // 启用/禁用确认按钮
      confirmBtn.disabled = selectedColors.length !== 3;
    }
    
    // 绑定所有事件监听
    function bindEventListeners() {
      // 设计按钮点击
      document.getElementById('designBtn').addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('colorModal').style.display = 'flex';
        resetColorSelection();
      });
      
      // 关闭模态框
      document.getElementById('closeModal').addEventListener('click', function() {
        document.getElementById('colorModal').style.display = 'none';
      });
      
      // 取消按钮
      document.getElementById('cancelBtn').addEventListener('click', function() {
        document.getElementById('colorModal').style.display = 'none';
      });
      
      // 确认选择按钮
      document.getElementById('confirmBtn').addEventListener('click', function() {
        showDeclarationResult();
      });
      
      // 返回选择按钮
      document.getElementById('backToSelectionBtn').addEventListener('click', function() {
        document.getElementById('colorSelectionView').style.display = 'block';
        document.getElementById('declarationResultView').style.display = 'none';
        document.getElementById('paymentView').style.display = 'none';
        document.getElementById('paymentSuccessView').style.display = 'none';
      });
      
      // 生成邦典按钮
      document.getElementById('generateBangdianBtn').addEventListener('click', function() {
        document.getElementById('declarationResultView').style.display = 'none';
        document.getElementById('paymentView').style.display = 'block';
        resetPaymentSelection();
      });
      
      // 支付选项卡片点击
      document.getElementById('digitalCard').addEventListener('click', function() {
        selectPaymentType(this);
      });
      
      document.getElementById('physicalCard').addEventListener('click', function() {
        selectPaymentType(this);
        document.getElementById('workshopCustomization').style.display = 'block';
      });
      
      // 返回宣言按钮
      document.getElementById('backToDeclarationBtn').addEventListener('click', function() {
        document.getElementById('paymentView').style.display = 'none';
        document.getElementById('declarationResultView').style.display = 'block';
        document.getElementById('workshopCustomization').style.display = 'none';
      });
      
      // 确认支付按钮
      document.getElementById('confirmPaymentBtn').addEventListener('click', function() {
        processPayment();
      });
      
      // 关闭支付按钮
      document.getElementById('closePaymentBtn').addEventListener('click', function() {
        document.getElementById('colorModal').style.display = 'none';
        document.getElementById('workshopCustomization').style.display = 'none';
      });
      
      // 关闭成功弹窗按钮
      document.getElementById('closeSuccessBtn').addEventListener('click', function() {
        document.getElementById('colorModal').style.display = 'none';
      });
      
      // 返回主页按钮
      document.getElementById('backToHomeBtn').addEventListener('click', function() {
        document.getElementById('colorModal').style.display = 'none';
      });
      
      // 查看图片按钮
      document.getElementById('viewImageBtn').addEventListener('click', function() {
        document.getElementById('imageViewerModal').style.display = 'flex';
        
        // 显示高清图片
        const container = document.getElementById('fullSizeImageContainer');
        const selectedCombination = getSelectedColorCombination();
        
        container.innerHTML = `
          <img src="${selectedCombination.imageUrl}" alt="高清邦典图片" class="full-size-image">
        `;
      });
      
      // 关闭图片查看器
      document.getElementById('closeImageViewer').addEventListener('click', function() {
        document.getElementById('imageViewerModal').style.display = 'none';
      });
      
      document.getElementById('closeViewerBtn').addEventListener('click', function() {
        document.getElementById('imageViewerModal').style.display = 'none';
      });
    }
    
    // 重置颜色选择
    function resetColorSelection() {
      selectedColors = [];
      document.querySelectorAll('.color-card').forEach(card => {
        card.classList.remove('selected');
      });
      updateSelectedCount();
      
      // 显示颜色选择视图，隐藏其他视图
      document.getElementById('colorSelectionView').style.display = 'block';
      document.getElementById('declarationResultView').style.display = 'none';
      document.getElementById('paymentView').style.display = 'none';
      document.getElementById('paymentSuccessView').style.display = 'none';
      document.getElementById('workshopCustomization').style.display = 'none';
    }
    
    // 重置支付选择
    function resetPaymentSelection() {
      selectedPaymentType = null;
      document.getElementById('digitalCard').classList.remove('selected');
      document.getElementById('physicalCard').classList.remove('selected');
      document.getElementById('confirmPaymentBtn').disabled = true;
      document.getElementById('paymentAmount').textContent = '支付金额：¥0.00';
      document.getElementById('qrCodeSection').style.display = 'block';
      document.getElementById('paymentProcessing').style.display = 'none';
    }
    
    // 选择支付类型
    function selectPaymentType(card) {
      // 移除其他选中状态
      document.querySelectorAll('.payment-card').forEach(c => {
        c.classList.remove('selected');
      });
      
      // 添加当前选中状态
      card.classList.add('selected');
      selectedPaymentType = {
        type: card.dataset.type,